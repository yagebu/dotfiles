#!/bin/sh

echo "checking if we're online..."
Q="0"
while [ $Q = "0" ]; do
   Q=$(ping -c1 www.google.com 2> /dev/null | grep -c google);
   sleep 3
done

echo 'online'

REPOSITORY=ks:backup/js-arch.attic

# Backup all of /etc and /home except a few excluded directories
attic create --stats                                \
    $REPOSITORY::`date +%Y-%m-%d`                   \
    /home                                           \
    /etc                                            \
    --exclude /etc/ca-certificates                  \
    --exclude /etc/udev                             \
    --exclude /etc/ssl                              \
    --exclude /home/jakob/.cache                    \
    --exclude /home/jakob/.config/chromium          \
    --exclude /home/jakob/.config/fresh             \
    --exclude /home/jakob/.config/syncthing/index   \
    --exclude /home/jakob/.config/vim               \
    --exclude /home/jakob/.thunderbird              \
    --exclude /home/jakob/.VirtualBox               \
    --exclude /home/jakob/Movies                    \
    --exclude /home/jakob/Music                     \
    --exclude /home/jakob/Pictures                  \
    --exclude /home/jakob/VMs                       \
    --exclude '*.pyc'

attic prune -v $REPOSITORY --keep-daily=14 --keep-weekly=8 --keep-monthly=12 --keep-yearly=10
